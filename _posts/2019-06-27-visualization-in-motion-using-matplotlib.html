---
layout:     post
title:      Visualization in motion using Matplotlib
excerpt:    Exporting animated visualizations such as image sequences, gifs or videos.
date:       2019-06-27
categories: [Data Visualization]
mathjax:    false
---

<p>
    <a href="https://matplotlib.org/" target="_blank">Matplotlib</a> is perhaps the most popular data/scientific visualization library for <code>python</code>. Despite normally working with static figures, it also provides some decent ways to produce moving imaging. Let's take a look in how to export visually our animated data.
</p>

<ul>
    <li><a href="#exp-imgseq">1. Exporting image sequence</a></li>
    <li><a href="#exp-gif">2. Exporting GIFs</a></li>
    <li><a href="#exp-vid">3. Exporting videos</a></li>
</ul>

<p>
    All examples exposed here and much others can be checked out on the following <code>notebook</code>:
</p>

<p>{% include icon-github.svg %} Notebook: <a href="https://diegoinacio.github.io/computer-vision-notebooks/pages/matplotlib_animation.html" target="_blank">matplotlib_animation.ipynb</a></p>


<h2 id="exp-imgseq">1. Exporting image sequence</h2>

<p>
    Exporting an image sequence basically consists of looping a batch of functions which are responsible for saving our <em>matplotlib</em>'s image showing. After getting the picture sequence (oredered or not), we are able to produce <code>videos</code>, <code>gifs</code> or any kind of <em>moving visual image media</em> using editing softwares such as <a href="https://www.gimp.org/" target="_blank">GIMP</a>, <a href="https://www.openshot.org/" target="_blank">OpenShot</a>, <a href="https://natrongithub.github.io/" target="_blank">Natron</a> or many others. The basic structure for the export process can be understood as:
</p>

{% highlight python %}
...
import matplotlib.pyplot as plt

fig, (axA, axB) = plt.subplots(1, 2)

NFRAMES = 9

for frame in range(NFRAMES):
    axA.imshow(imageA) # show imageA on axis A
    axB.imshow(imageB) # show imageB on axis B

    # function responsible for saving our visualization
    plt.savefig('path/to/output_sequence/image.{0:04d}.png'.format(frame))

    axA.cla(); axB.cla() # clear axes
...
{% endhighlight %}

<p>
    As a result, we have a sequence of pictures like <code>image.0000.png</code>, <code>image.0001.png</code>, ..., <code>image.0008.png</code>, similar to the following example, which shows the hue shifting of an image.
</p>

<table>
    <tr>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0000.png'></td>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0001.png'></td>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0002.png'></td>
    </tr>
    <tr>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0003.png'></td>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0004.png'></td>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0005.png'></td>
    </tr>
    <tr>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0006.png'></td>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0007.png'></td>
        <td><img src='/images/visualizations/matplotlib_animation_colorShift.0008.png'></td>
    </tr>
</table>


<h2 id="exp-gif">2. Exporting GIFs</h2>

<p>
    Before exporting GIFs, we have to install a free and opensource software called <a href="https://imagemagick.org/" target="_blank">ImageMagick</a> which is going to work together with matplotlib's animation module. To install ImageMagick:
</p>

Linux and OSX

{% highlight bash %}
$ sudo apt install imagemagick
{% endhighlight %}

Anaconda environments

{% highlight bash %}
$ conda install --channel conda-forge imagemagick
{% endhighlight %}

<p>
    If you are an windows user, just follow the link for <a href="https://imagemagick.org/script/download.php" target="_blank">ImageMagick download</a>.
</p>

{% highlight python %}
...
import matplotlib.pyplot as plt
import matplotlib.animation as manim

# the following line is only for windows users!
plt.rcParams["animation.convert_path"] = "C:/ProgramFiles/ImageMagick/magick.exe"

fig, ax = plt.subplots()

NFRAMES = 30  # number of frames
FINTERV = 100 # interval between frames (in milliseconds)

def animation(frame):
    plt.cla() # clear all axes
    imshow = ax.imshow(image)

    return imshow

anim = manim.FuncAnimation(fig, animation, frames=NFRAMES, interval=FINTERV)

anim.save('path/to/output/animated.gif', writer="imagemagick", extra_args="convert")
...
{% endhighlight %}

<p>
    The result is an animated GIF such as the following example, which shows a <em>Reaction Diffusion System</em>.
</p>

<img src="/images/visualizations/matplotlib_animation_reactionDiffusion.gif" alt="reaction diffusion gif"/>


<h2 id="exp-vid">3. Exporting videos</h2>

<p>
    Similarly to GIFs, we have to install an extra framework to work together with matplotlib's animation module. In this instance, the well-known <a href="https://ffmpeg.org/" target="_blank">FFmpeg</a> is probably our best choice. To install it:
</p>

Linux and OSX

{% highlight bash %}
$ sudo apt-get install ffmpeg
{% endhighlight %}

Anaconda environments

{% highlight bash %}
$ conda install --channel conda-forge ffmpeg
{% endhighlight %}

{% highlight python %}
...
import matplotlib.pyplot as plt
import matplotlib.animation as manim

FFMpegWriter = manim.writers['ffmpeg']
metadata = dict(title='Video title', artist='Author name',
                comment='Exporting movies using Python and Matplotlib')
writer = FFMpegWriter(fps=15, metadata=metadata)

fig, (axA, axB) = plt.subplots(1, 2)

NFRAMES = 90
with writer.saving(fig, 'path/to/output/video.mp4', NFRAMES):
    for i in range(NFRAMES):
        axA.imshow(imageA)  # show imageA on axis A
        axB.imshow(imageB)  # show imageB on axis B
        
        writer.grab_frame() # write current frame

        # basic way to show the exporting progress
        # very important because sometimes it takes time
        print('{:06.2f} %'.format(100*(i + 1)/NFRAMES), end='\r', flush=True)
...
{% endhighlight %}

<p>
    The result is a video such as the following example, which shows a 2D Bandpass Filter.
</p>

<iframe width="900" height="450" src="https://www.youtube.com/embed/rhDsIkeOyqk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
